<UserControl x:Class="Samba.Modules.FastPay.FastTicketView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:cmn="clr-namespace:Samba.Presentation.Common;assembly=Samba.Presentation.Common"
             xmlns:FxButton="clr-namespace:FlexButton;assembly=FlexButton"
             xmlns:cal="clr-namespace:Microsoft.Practices.Prism.Regions;assembly=Microsoft.Practices.Prism"
             mc:Ignorable="d" d:DesignHeight="200" d:DesignWidth="200">

    <UserControl.Resources>
        <!-- ⭐ ACTION BUTTON STYLE (Clear / Discount için özel) -->
        <Style x:Key="ActionButtonStyle" TargetType="{x:Type FxButton:FlexButton}">

            <Setter Property="Height" Value="90"/>

            <Setter Property="BorderBrush" Value="#999"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Background" Value="#EEEEEE"/>
            <Setter Property="Foreground" Value="#222"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type FxButton:FlexButton}">
                        <Border x:Name="border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="0">

                            <ContentPresenter HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Margin="4"/>

                        </Border>

                        <ControlTemplate.Triggers>

                            <!-- Hover -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#D6D6D6"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#B5B5B5"/>
                            </Trigger>

                            <!-- Pressed -->
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#C1C1C1"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#A0A0A0"/>
                            </Trigger>

                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

        </Style>

    </UserControl.Resources>






    <Grid Name="MainGrid" Margin="3,0,0,0" >
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="8*"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Name="Column1" Width="2*" />
            <ColumnDefinition Name="Column2" Width="17*" />
        </Grid.ColumnDefinitions>

        <!--TITLE AREA-->
        <Label Name="TitleLabel" Grid.Row="0" Grid.Column="1" Content="{Binding SelectedTicketTitle}" Margin="0,0,3,0"
               FontWeight="Bold" FontSize="18" Background="DarkGray" Foreground="WhiteSmoke" BorderThickness="0"/>

        <!--ORDERS AREA-->
        <ContentControl Grid.Row="1" Grid.Column="1" Margin="0,0,3,0"
                        cal:RegionManager.RegionName="{x:Static cmn:RegionNames.FastTicketOrdersRegion}"/>

        <!--TICKET INFO AREA-->
        <ContentControl Grid.Row="2" Grid.Column="1" Margin="0,0,3,0"
                        cal:RegionManager.RegionName="{x:Static cmn:RegionNames.FastTicketInfoRegion}" Grid.RowSpan="4"/>

        <!--TICKET TOTALS AREA-->
        <ContentControl Grid.Row="3" Grid.Column="1" Margin="0,0,3,0"
                        cal:RegionManager.RegionName="{x:Static cmn:RegionNames.FastTicketTotalsRegion}" Grid.RowSpan="3"/>

        <!--PAYMENT BUTTONS AREA (ROW 1)-->
        <ItemsControl Grid.Row="4" Grid.Column="1"
                      ItemsSource="{Binding UnderTicketAutomationCommands,NotifyOnTargetUpdated=True}" Grid.RowSpan="2">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="1"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <FxButton:FlexButton Height="65" Margin="0,0,3,3"
                                         Command="{Binding DataContext.ExecuteAutomationCommnand,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ItemsControl}}}"
                                         CommandParameter="{Binding .}" Content="{Binding Display}"
                                         FontSize="{Binding FontSize}"
                                         ButtonColor="{Binding Color,Converter={StaticResource NullBrushConverter}}"
                                         Visibility="{Binding IsVisible,Converter={StaticResource VisibilityConverter}}"/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!--PAYMENT BUTTONS AREA (ROW 2)-->
        <ItemsControl Grid.Row="5" Grid.Column="1"
                      ItemsSource="{Binding UnderTicketRow2AutomationCommands,NotifyOnTargetUpdated=True}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="1"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <FxButton:FlexButton Height="65" Margin="0,0,3,3"
                                         Command="{Binding DataContext.ExecuteAutomationCommnand,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ItemsControl}}}"
                                         CommandParameter="{Binding .}" Content="{Binding Display}"
                                         FontSize="{Binding FontSize}"
                                         ButtonColor="{Binding Color,Converter={StaticResource NullBrushConverter}}"
                                         Visibility="{Binding IsVisible,Converter={StaticResource VisibilityConverter}}"/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!--COMMAND BUTTONS AREA-->
        <StackPanel Name="CommandButtonsColumn"
            Grid.Column="0"
            Grid.Row="0"
            Grid.RowSpan="7"
            VerticalAlignment="Top"
            Height="880">

            <StackPanel.Resources>
                <Style TargetType="FxButton:FlexButton">
                    <Setter Property="Height" Value="65"/>
                    <Setter Property="Margin" Value="0,0,0,3"/>
                    <Setter Property="FontSize" Value="18"/>
                </Style>
            </StackPanel.Resources>

            <!-- Top-level add/modify -->
            <FxButton:FlexButton Command="{Binding AddOrderCommand}"
                                 Content="{Binding AddOrderCommand.Caption}"
                                 Visibility="{Binding IsAddOrderButtonVisible,Converter={StaticResource VisibilityConverter}}"/>
            <FxButton:FlexButton Command="{Binding ModifyOrderCommand}"
                                 Content="{Binding ModifyOrderCommand.Caption}"
                                 Visibility="{Binding IsModifyOrderButtonVisible,Converter={StaticResource VisibilityConverter}}"/>

            <!-- Quantity controls for unlocked items -->
            <FxButton:FlexButton Command="{Binding IncQuantityCommand}"
                                 Content="{Binding IncQuantityCommand.Caption}"
                                 Visibility="{Binding IsItemsSelectedAndUnlocked,Converter={StaticResource VisibilityConverter}}"/>
            <FxButton:FlexButton Command="{Binding DecQuantityCommand}"
                                 Content="{Binding DecQuantityCommand.Caption}"
                                 Visibility="{Binding IsItemsSelectedAndUnlocked,Converter={StaticResource VisibilityConverter}}"/>

            <!-- Quantity controls for locked items (selected quantity) -->
            <FxButton:FlexButton Command="{Binding IncSelectionQuantityCommand}"
                                 Content="{Binding IncSelectionQuantityCommand.Caption}"
                                 Visibility="{Binding IsItemsSelectedAndLocked,Converter={StaticResource VisibilityConverter}}"/>
            <FxButton:FlexButton Command="{Binding DecSelectionQuantityCommand}"
                                 Content="{Binding DecSelectionQuantityCommand.Caption}"
                                 Visibility="{Binding IsItemsSelectedAndLocked,Converter={StaticResource VisibilityConverter}}"/>

            <!-- Cancel / move / price change -->
            <FxButton:FlexButton Command="{Binding CancelItemCommand}"
                                 Content="{Binding CancelItemCommand.Caption}"
                                 Visibility="{Binding IsItemsSelected,Converter={StaticResource VisibilityConverter}}"/>

            <FxButton:FlexButton Command="{Binding ChangePriceCommand}"
                                 Content="{Binding ChangePriceCommand.Caption}"
                                 Visibility="{Binding IsItemsSelectedAndUnlocked,Converter={StaticResource VisibilityConverter}}"/>

            <FxButton:FlexButton Command="{Binding MoveOrdersCommand}"
                                 Content="{Binding MoveOrdersCommand.Caption}"
                                 Visibility="{Binding IsItemsSelected,Converter={StaticResource VisibilityConverter}}"/>

            <!-- Ticket tags (no entity buttons in FastPay) -->
            <ItemsControl ItemsSource="{Binding TicketTagButtons,NotifyOnTargetUpdated=True}"
                          HorizontalAlignment="Stretch"
                          Visibility="{Binding IsNothingSelectedAndTicketTagged,Converter={StaticResource VisibilityConverter}}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel VerticalAlignment="Top"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <FxButton:FlexButton Command="{Binding DataContext.ShowTicketTagsCommand,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ItemsControl}}}"
                                             CommandParameter="{Binding Model}" Content="{Binding Caption}"
                                             ButtonColor="{Binding ButtonColor,Converter={StaticResource NullBrushConverter}}"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Clearing handling -->
            <FxButton:FlexButton Command="{Binding ClearTicketContentsCommand}"
                                     Style="{StaticResource ActionButtonStyle}"
                     Content="{Binding ClearTicketContentsCommand.Caption}"
                     Visibility="{Binding IsNothingSelected, Converter={StaticResource VisibilityConverter}}"/>
            <!-- Discount Handling -->
            <FxButton:FlexButton Command="{Binding DiscountCommand}"
                                     Style="{StaticResource ActionButtonStyle}"
                     Content="{Binding DiscountCommand.Caption}"
                     Visibility="{Binding IsTicketSelected,Converter={StaticResource VisibilityConverter}}"/>

            <!-- Temporary Push - Pop -->
            <FxButton:FlexButton Command="{Binding HoldTicketCommand}"
                     Content="{Binding HoldTicketCaption}"
                     Visibility="{Binding IsHoldButtonVisible,
                                          Converter={StaticResource VisibilityConverter}}"/>



            <FxButton:FlexButton Command="{Binding RemoveTicketLockCommand}"
                                 Content="{Binding RemoveTicketLockCommand.Caption}"
                                 Visibility="{Binding IsNothingSelectedAndTicketLocked,Converter={StaticResource VisibilityConverter}}"/>





        </StackPanel>
    </Grid>
</UserControl>
